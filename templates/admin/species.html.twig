{% extends 'base.html.twig' %}

{% block title %}Administration Esp√®ces - Chronicles{% endblock %}

{% block page_title %}Gestion des Esp√®ces{% endblock %}

{% block body %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <div>
        <h2 style="margin: 0;">Gestion des Esp√®ces</h2>
        <p style="margin: 0.5rem 0 0 0; color: #666;">Cr√©ez, modifiez et supprimez les esp√®ces et leurs races associ√©es</p>
    </div>
    <div>
        <a href="{{ path('admin_dashboard') }}" class="btn">‚Üê Retour au Dashboard</a>
        <button onclick="openSpeciesModal()" class="btn" style="background: #2ecc71; margin-left: 0.5rem;">+ Nouvelle Esp√®ce</button>
    </div>
</div>

<!-- Management Tabs -->
<div style="display: flex; border-bottom: 1px solid #dee2e6; margin-bottom: 2rem;">
    <button onclick="switchTab('species')" id="species-tab" class="tab-btn active" style="padding: 1rem 2rem; border: none; background: none; cursor: pointer; border-bottom: 2px solid #3498db;">
        Esp√®ces
    </button>
    <button onclick="switchTab('races')" id="races-tab" class="tab-btn" style="padding: 1rem 2rem; border: none; background: none; cursor: pointer; border-bottom: 2px solid transparent;">
        Races
    </button>
    <button onclick="switchTab('stats')" id="stats-tab" class="tab-btn" style="padding: 1rem 2rem; border: none; background: none; cursor: pointer; border-bottom: 2px solid transparent;">
        Statistiques
    </button>
</div>

<!-- Species Management Tab -->
<div id="species-panel" class="tab-panel">
    <div style="background: white; border-radius: 8px; padding: 2rem;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h3>Liste des Esp√®ces</h3>
            <div>
                <input type="text" id="species-search" placeholder="Rechercher une esp√®ce..." style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; margin-right: 1rem;">
                <button onclick="openSpeciesModal()" class="btn" style="background: #2ecc71;">+ Ajouter</button>
            </div>
        </div>

        <div id="species-container">
            <div style="text-align: center; padding: 3rem; color: #666;">
                <span style="font-size: 4rem; opacity: 0.5;">üß¨</span>
                <h3>Chargement des esp√®ces...</h3>
                <p>Les esp√®ces seront affich√©es ici une fois les entit√©s Doctrine cr√©√©es</p>
            </div>
        </div>
    </div>
</div>

<!-- Races Management Tab -->
<div id="races-panel" class="tab-panel" style="display: none;">
    <div style="background: white; border-radius: 8px; padding: 2rem;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h3>Liste des Races</h3>
            <div>
                <select id="species-filter" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; margin-right: 1rem;">
                    <option value="">Toutes les esp√®ces</option>
                </select>
                <button onclick="openRaceModal()" class="btn" style="background: #2ecc71;">+ Ajouter Race</button>
            </div>
        </div>

        <div id="races-container">
            <div style="text-align: center; padding: 3rem; color: #666;">
                <span style="font-size: 4rem; opacity: 0.5;">üèÉ</span>
                <h3>Chargement des races...</h3>
                <p>Les races seront affich√©es ici une fois les entit√©s Doctrine cr√©√©es</p>
            </div>
        </div>
    </div>
</div>

<!-- Statistics Tab -->
<div id="stats-panel" class="tab-panel" style="display: none;">
    <div style="background: white; border-radius: 8px; padding: 2rem;">
        <h3>Statistiques de l'Univers</h3>
        
        <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); margin: 2rem 0;">
            <div style="background: #3498db; color: white; padding: 1.5rem; border-radius: 8px; text-align: center;">
                <h4 style="margin: 0 0 0.5rem 0;">Total Esp√®ces</h4>
                <div style="font-size: 2.5rem; font-weight: bold;">0</div>
            </div>
            
            <div style="background: #2ecc71; color: white; padding: 1.5rem; border-radius: 8px; text-align: center;">
                <h4 style="margin: 0 0 0.5rem 0;">Total Races</h4>
                <div style="font-size: 2.5rem; font-weight: bold;">0</div>
            </div>
            
            <div style="background: #e74c3c; color: white; padding: 1.5rem; border-radius: 8px; text-align: center;">
                <h4 style="margin: 0 0 0.5rem 0;">Races/Esp√®ce Moyen</h4>
                <div style="font-size: 2.5rem; font-weight: bold;">0</div>
            </div>
        </div>

        <div style="margin-top: 2rem;">
            <h4>Races par Esp√®ce</h4>
            <div id="species-stats" style="margin-top: 1rem;">
                <p style="color: #666; font-style: italic;">Les statistiques seront disponibles une fois les donn√©es charg√©es</p>
            </div>
        </div>
    </div>
</div>

<!-- Species Modal -->
<div id="species-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: 8px; padding: 2rem; width: 90%; max-width: 500px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h3 id="species-modal-title">Nouvelle Esp√®ce</h3>
            <button onclick="closeSpeciesModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
        </div>

        <form id="species-form">
            <input type="hidden" id="species-id" name="species_id">
            
            <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Nom de l'Esp√®ce *</label>
                <input type="text" id="species-name" name="species_name" required style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
            </div>

            <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Ic√¥ne de l'Esp√®ce</label>
                <input type="file" id="species-icon" name="species_icon" accept="image/*" style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                <small style="color: #666;">Maximum 5 Mo - Formats accept√©s: JPG, PNG, GIF</small>
            </div>

            <div style="margin-bottom: 1.5rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Description</label>
                <textarea id="species-description" name="species_description" rows="4" style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; resize: vertical;"></textarea>
            </div>

            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                <button type="button" onclick="closeSpeciesModal()" class="btn" style="background: #6c757d;">Annuler</button>
                <button type="button" onclick="deleteCurrentSpecies()" id="species-delete-btn" style="display: none;" class="btn" style="background: #dc3545;">Supprimer</button>
                <button type="submit" class="btn" style="background: #2ecc71;">Enregistrer</button>
            </div>
        </form>
    </div>
</div>

<!-- Race Modal -->
<div id="race-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: 8px; padding: 2rem; width: 90%; max-width: 500px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h3 id="race-modal-title">Nouvelle Race</h3>
            <button onclick="closeRaceModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
        </div>

        <form id="race-form">
            <input type="hidden" id="race-id" name="race_id">
            
            <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Nom de la Race *</label>
                <input type="text" id="race-name" name="race_name" required style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
            </div>

            <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Esp√®ce Parente *</label>
                <select id="race-species" name="species_id" required style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="">S√©lectionner une esp√®ce...</option>
                </select>
            </div>

            <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Ic√¥ne de la Race</label>
                <input type="file" id="race-icon" name="race_icon" accept="image/*" style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
            </div>

            <div style="margin-bottom: 1.5rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Description</label>
                <textarea id="race-description" name="race_description" rows="3" style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; resize: vertical;"></textarea>
            </div>

            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                <button type="button" onclick="closeRaceModal()" class="btn" style="background: #6c757d;">Annuler</button>
                <button type="button" onclick="deleteCurrentRace()" id="race-delete-btn" style="display: none;" class="btn" style="background: #dc3545;">Supprimer</button>
                <button type="submit" class="btn" style="background: #2ecc71;">Enregistrer</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
let currentSpeciesId = null;
let currentRaceId = null;

// Tab Management
function switchTab(tabName) {
    // Hide all panels
    document.querySelectorAll('.tab-panel').forEach(panel => {
        panel.style.display = 'none';
    });
    
    // Remove active class from all tabs
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.style.borderBottomColor = 'transparent';
        btn.classList.remove('active');
    });
    
    // Show selected panel and activate tab
    document.getElementById(tabName + '-panel').style.display = 'block';
    document.getElementById(tabName + '-tab').style.borderBottomColor = '#3498db';
    document.getElementById(tabName + '-tab').classList.add('active');
    
    // Load data for the selected tab
    if (tabName === 'species') {
        loadSpeciesList();
    } else if (tabName === 'races') {
        loadRacesList();
    } else if (tabName === 'stats') {
        loadStatistics();
    }
}

// Species Management
function openSpeciesModal(speciesId = null) {
    currentSpeciesId = speciesId;
    
    if (speciesId) {
        document.getElementById('species-modal-title').textContent = 'Modifier l\'Esp√®ce';
        document.getElementById('species-delete-btn').style.display = 'inline-block';
        loadSpeciesData(speciesId);
    } else {
        document.getElementById('species-modal-title').textContent = 'Nouvelle Esp√®ce';
        document.getElementById('species-delete-btn').style.display = 'none';
        clearSpeciesForm();
    }
    
    document.getElementById('species-modal').style.display = 'block';
}

function closeSpeciesModal() {
    document.getElementById('species-modal').style.display = 'none';
    clearSpeciesForm();
}

function clearSpeciesForm() {
    document.getElementById('species-form').reset();
    document.getElementById('species-id').value = '';
}

// Race Management
function openRaceModal(raceId = null) {
    currentRaceId = raceId;
    
    if (raceId) {
        document.getElementById('race-modal-title').textContent = 'Modifier la Race';
        document.getElementById('race-delete-btn').style.display = 'inline-block';
        loadRaceData(raceId);
    } else {
        document.getElementById('race-modal-title').textContent = 'Nouvelle Race';
        document.getElementById('race-delete-btn').style.display = 'none';
        clearRaceForm();
    }
    
    // Load species options for race form
    loadSpeciesOptions();
    document.getElementById('race-modal').style.display = 'block';
}

function closeRaceModal() {
    document.getElementById('race-modal').style.display = 'none';
    clearRaceForm();
}

function clearRaceForm() {
    document.getElementById('race-form').reset();
    document.getElementById('race-id').value = '';
}

// Data Loading Functions (Placeholders)
function loadSpeciesList() {
    console.log('Loading species list...');
    // TODO: Implement when entities are ready
}

function loadRacesList() {
    console.log('Loading races list...');
    // TODO: Implement when entities are ready
}

function loadStatistics() {
    console.log('Loading statistics...');
    // TODO: Implement when entities are ready
}

function loadSpeciesData(speciesId) {
    console.log('Loading species data for ID:', speciesId);
    // TODO: Implement when entities are ready
}

function loadRaceData(raceId) {
    console.log('Loading race data for ID:', raceId);
    // TODO: Implement when entities are ready
}

function loadSpeciesOptions() {
    console.log('Loading species options...');
    // TODO: Implement when entities are ready
}

// Delete Functions
function deleteCurrentSpecies() {
    if (currentSpeciesId && confirm('√ätes-vous s√ªr de vouloir supprimer cette esp√®ce et toutes ses races associ√©es ?')) {
        console.log('Deleting species ID:', currentSpeciesId);
        // TODO: Implement deletion
        closeSpeciesModal();
    }
}

function deleteCurrentRace() {
    if (currentRaceId && confirm('√ätes-vous s√ªr de vouloir supprimer cette race ?')) {
        console.log('Deleting race ID:', currentRaceId);
        // TODO: Implement deletion
        closeRaceModal();
    }
}

// Form Submissions
document.getElementById('species-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    console.log('Species form data:', Object.fromEntries(formData.entries()));
    // TODO: Submit via AJAX when backend is ready
    alert('Fonction de sauvegarde de l\'esp√®ce √† impl√©menter');
    closeSpeciesModal();
});

document.getElementById('race-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    console.log('Race form data:', Object.fromEntries(formData.entries()));
    // TODO: Submit via AJAX when backend is ready
    alert('Fonction de sauvegarde de la race √† impl√©menter');
    closeRaceModal();
});

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    loadSpeciesList();
});

// Close modals when clicking outside
document.getElementById('species-modal').addEventListener('click', function(e) {
    if (e.target === this) closeSpeciesModal();
});

document.getElementById('race-modal').addEventListener('click', function(e) {
    if (e.target === this) closeRaceModal();
});
</script>
{% endblock %}